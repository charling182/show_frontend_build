(self["webpackChunk"]=self["webpackChunk"]||[]).push([[282],{75074:function(){},16981:function(e){e.exports={"project-template-task":"project-template-task___1uFL7","create-template":"create-template___ahvaH",list:"list___3Kh_5","item-list":"item-list___3-BW1","item-info":"item-info___24bga","item-tasks":"item-tasks___3K9Hc","item-control":"item-control___2i4q4",intro:"intro___N-xNI"}},78728:function(e){e.exports={"project-template":"project-template___KzbkC","create-template":"create-template___3UPwI",list:"list___2ozxs","item-list":"item-list___145N2","item-img":"item-img___h09JD","item-info":"item-info___MxeaF","item-tasks":"item-tasks___puRvH",task:"task___1M0-W","item-control":"item-control___2kd0-","color-light":"color-light___2f6MH"}},84687:function(e,t,a){"use strict";a.r(t),a.d(t,{default:function(){return K}});a(25324);var n=a(45733),r=(a(13753),a(48429)),c=a(90636),l=(a(14643),a(92909)),s=a(3182),i=a(2824),m=(a(26780),a(86444)),o=(a(84786),a(45873)),u=a(67294),d=a(87588),p=a(93488),Z=a(5405),f=a(47389),v=a(82061),E=a(51042),_=a(78728),h=a.n(_),k=(a(68137),a(50532)),g=(a(83557),a(78840)),w=(a(67604),a(76592)),x=a(90016),b=a(75074),y=a.n(b),S=a(30155),N=e=>{var t=e.selectedTemplate,a=e.editVisible,n=e.handleEditSuccess,r=w.Z.useForm(),o=(0,i.Z)(r,1),d=o[0],p=t&&t.id?"\u7f16\u8f91\u6a21\u677f":"\u6dfb\u52a0\u6a21\u677f",Z=(0,u.useState)(""),f=(0,i.Z)(Z,2),v=f[0],_=f[1],h=u.createElement("div",null,u.createElement(E.Z,null),u.createElement("div",{style:{marginTop:8}},"Upload")),b=()=>{d.resetFields(),_("")},N=()=>{b(),n("quit")},T=function(){var e=(0,s.Z)((0,c.Z)().mark((function e(){var a,r,s,i,m;return(0,c.Z)().wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,d.validateFields();case 2:if(a=e.sent,null===t||void 0===t||!t.id){e.next=13;break}return a.cover=v,a.id=null===t||void 0===t?void 0:t.id,e.next=8,(0,S.hV)(a);case 8:r=e.sent,s=r.code,200===s&&(l.default.success("\u7f16\u8f91\u6210\u529f"),b(),n("success")),e.next=19;break;case 13:return a.cover=v,e.next=16,(0,S.$p)(a);case 16:i=e.sent,m=i.code,200===m&&(l.default.success("\u6dfb\u52a0\u6210\u529f"),b(),n("success"));case 19:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),j=e=>{var t="image/jpeg"===e.type||"image/png"===e.type;if(!t)return l.default.error("\u4f60\u9700\u8981\u4e0a\u4f20jpeg\u6216\u8005png\u56fe\u7247\u683c\u5f0f!"),!1;var a=e.size/1024/1024<5;return a?(C(e),!1):(l.default.error("\u56fe\u7247\u5fc5\u987b\u5c0f\u4e8e5MB!"),!1)},C=function(){var e=(0,s.Z)((0,c.Z)().mark((function e(t){var a,n,r;return(0,c.Z)().wrap((function(e){while(1)switch(e.prev=e.next){case 0:return a=new FormData,a.append("file",t),e.next=4,(0,S.cT)(a);case 4:n=e.sent,n.code,r=n.data,_(r.path);case 8:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}();return(0,u.useEffect)((()=>{a&&null!==t&&void 0!==t&&t.id&&(d.setFieldsValue(t),_(null===t||void 0===t?void 0:t.cover))}),[t,a]),u.createElement("div",{className:y()["project-template-edit"]},u.createElement(m.Z,{title:p,open:a,onCancel:N,onOk:T},u.createElement(w.Z,{form:d,layout:"vertical"},u.createElement(w.Z.Item,{label:"\u5c01\u9762",name:"cover"},u.createElement(x.Z,{rotationSlider:!0},u.createElement(g.Z,{name:"image",listType:"picture-card",showUploadList:!1,beforeUpload:j},v?u.createElement("img",{src:v,alt:"image",style:{width:"100%"}}):h))),u.createElement(w.Z.Item,{label:"\u540d\u79f0",name:"name",rules:[{required:!0,message:"\u8bf7\u8f93\u5165\u6a21\u677f\u540d\u79f0"}]},u.createElement(k.Z,{placeholder:"\u6a21\u677f\u540d\u79f0\uff08\u5fc5\u987b\uff09"})),u.createElement(w.Z.Item,{label:"\u7b80\u4ecb",name:"intro"},u.createElement(k.Z.TextArea,{rows:2,placeholder:"\u6a21\u677f\u7b80\u4ecb"})))))},T=N,j=(a(58210),a(87240)),C=a(16981),F=a.n(C),V=(a(11826),a(76888));function z(e){var t=e.editVisible,a=e.selectedTemplate,n=e.selectedTask,r=e.handleEditSuccess,o=w.Z.useForm(),d=(0,i.Z)(o,1),p=d[0],Z=(0,u.useState)(!1),f=(0,i.Z)(Z,2),v=(f[0],f[1],n&&n.id?"\u7f16\u8f91\u6a21\u677f\u4efb\u52a1":"\u6dfb\u52a0\u6a21\u677f\u4efb\u52a1"),E=(0,u.useState)({id:"",name:"",project_template_id:"",sort:0}),_=(0,i.Z)(E,2),h=(_[0],_[1],()=>{p.resetFields(),r("quit")}),g=()=>{p.validateFields().then(function(){var e=(0,s.Z)((0,c.Z)().mark((function e(t){var s,i,m,o;return(0,c.Z)().wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(console.log("values",t),t.project_template_id=a.id,null===n||void 0===n||!n.id){e.next=11;break}return t.id=n.id,e.next=6,(0,S.r9)(t);case 6:s=e.sent,i=s.code,200===i&&(l.default.success("\u4fee\u6539\u6210\u529f"),r("success")),e.next=16;break;case 11:return e.next=13,(0,S.wl)(t);case 13:m=e.sent,o=m.code,200===o&&(l.default.success("\u6dfb\u52a0\u6210\u529f"),r("success"));case 16:p.resetFields();case 17:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()).catch((e=>!1))};return(0,u.useEffect)((()=>{t&&null!==n&&void 0!==n&&n.id&&p.setFieldsValue(n)}),[n,t]),u.createElement(m.Z,{title:v,open:t,width:300,onCancel:h,onOk:g},u.createElement(w.Z,{form:p,layout:"vertical"},u.createElement(w.Z.Item,{label:"\u4efb\u52a1\u540d\u79f0",name:"name",rules:[{required:!0,message:"\u8bf7\u8f93\u5165\u4efb\u52a1\u540d\u79f0"},{min:2,max:30,message:"\u957f\u5ea6\u5728 2 \u5230 30 \u4e2a\u5b57\u7b26"}]},u.createElement(k.Z,{placeholder:"\u6a21\u677f\u4efb\u52a1\u540d\u79f0\uff08\u5fc5\u987b\uff09"})),u.createElement(w.Z.Item,{label:"\u6392\u5e8f",name:"sort"},u.createElement(V.Z,{defaultValue:0,style:{width:"100%"},placeholder:"\u6392\u5e8f"})),u.createElement("div",{style:{color:"#ccc"}},"\u6392\u5e8f\uff0c\u503c\u8d8a\u5927\u8d8a\u9760\u524d\uff0c\u9ed8\u8ba40")))}function I(e){var t=e.taskVisible,a=e.selectedTemplate,o=e.handleTaskEditSuccess,d=(0,u.useState)(!1),p=(0,i.Z)(d,2),Z=p[0],_=p[1],h=(0,u.useState)([]),k=(0,i.Z)(h,2),g=k[0],w=k[1],x=(0,u.useState)(0),b=(0,i.Z)(x,2),y=b[0],N=b[1],T=(0,u.useState)(!1),C=(0,i.Z)(T,2),V=C[0],I=C[1],q=(0,u.useState)({}),O=(0,i.Z)(q,2),H=O[0],K=O[1],M=e=>{I(!1),"success"===e&&N(y+1)};(0,u.useEffect)((()=>{t&&null!==a&&void 0!==a&&a.id&&U()}),[t,y]);var U=function(){var e=(0,s.Z)((0,c.Z)().mark((function e(){var t,n;return(0,c.Z)().wrap((function(e){while(1)switch(e.prev=e.next){case 0:return _(!0),e.next=3,(0,S.Ye)({project_template_id:null===a||void 0===a?void 0:a.id,prop_order:"sort",order:"desc",limit:1e3,offset:0});case 3:t=e.sent,n=t.data.rows,_(!1),w(n);case 7:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),P=(e,t)=>{t&&t.currentTarget.blur(),I(!0),K(e)},B=(e,t)=>{t&&t.currentTarget.blur(),m.Z.confirm({title:"\u4f60\u786e\u5b9a\u8981\u5220\u9664\u5f53\u524d\u9879\u5417",onOk:function(){var t=(0,s.Z)((0,c.Z)().mark((function t(){var a,n;return(0,c.Z)().wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,(0,S.P2)({ids:[e.id]});case 2:a=t.sent,n=a.code,200===n&&(N(y+1),l.default.success("\u5220\u9664\u6210\u529f"));case 5:case"end":return t.stop()}}),t)})));function a(){return t.apply(this,arguments)}return a}()})},D=()=>{o("success")};return u.createElement(m.Z,{title:"\u300c".concat(null===a||void 0===a?void 0:a.name,"\u300d\u4efb\u52a1\u5217\u8868"),open:t,onCancel:D,footer:null},u.createElement("div",{className:F()["project-template-task"]},u.createElement(j.Z,{spinning:Z},u.createElement("div",{className:F().list},g.map((e=>u.createElement("div",{key:e.id,className:F()["item-list"]},u.createElement("div",{className:F()["item-info"]},u.createElement("div",{className:F().name},e.name),u.createElement("div",{className:F().intro},"\u6392\u5e8f\uff1a",e.sort)),u.createElement(n.Z,{className:F()["item-control"]},u.createElement(r.Z,{icon:u.createElement(f.Z,null),shape:"circle",size:"small",onClick:t=>P(e,t)}),u.createElement(r.Z,{icon:u.createElement(v.Z,null),shape:"circle",size:"small",onClick:t=>B(e,t)}))))))),u.createElement(r.Z,{className:F()["create-template"],type:"primary",icon:u.createElement(E.Z,null),onClick:P},"\u6dfb\u52a0\u4efb\u52a1")),u.createElement(z,{editVisible:V,selectedTask:H,selectedTemplate:a,handleEditSuccess:M}))}var q=o.Z.TabPane,O=m.Z.confirm,H=()=>{var e=(0,u.useState)("0"),t=(0,i.Z)(e,2),a=t[0],m=t[1],_=(0,u.useState)(!1),k=(0,i.Z)(_,2),g=(k[0],k[1]),w=(0,u.useState)([]),x=(0,i.Z)(w,2),b=x[0],y=x[1],N=(0,u.useState)(!1),j=(0,i.Z)(N,2),C=j[0],F=j[1],V=(0,u.useState)(0),z=(0,i.Z)(V,2),H=z[0],K=z[1],M=(0,u.useState)({}),U=(0,i.Z)(M,2),P=U[0],B=U[1],D=(0,u.useState)(!1),L=(0,i.Z)(D,2),W=L[0],Y=L[1],A=["\u81ea\u5b9a\u4e49\u6a21\u677f","\u516c\u5171\u6a21\u677f"],J=e=>{Y(!1),"success"===e&&K(H+1)},R=e=>{F(!1),K(H+1)};function $(){return G.apply(this,arguments)}function G(){return G=(0,s.Z)((0,c.Z)().mark((function e(){var t,n;return(0,c.Z)().wrap((function(e){while(1)switch(e.prev=e.next){case 0:return console.log("\u83b7\u53d6\u5217\u8868",a),g(!0),e.prev=2,e.next=5,(0,S.Y7)({is_custom:"0"===a?1:0,limit:1e3,offset:0});case 5:t=e.sent,n=t.data.rows,y(n),e.next=13;break;case 10:e.prev=10,e.t0=e["catch"](2),l.default.error("\u83b7\u53d6\u5217\u8868\u5931\u8d25");case 13:return e.prev=13,g(!1),e.finish(13);case 16:case"end":return e.stop()}}),e,null,[[2,10,13,16]])}))),G.apply(this,arguments)}(0,u.useEffect)((()=>{$()}),[a,H]);var Q=(e,t)=>{t&&t.currentTarget.blur(),B(e),F(!0)};function X(e,t){t.currentTarget.blur(),B(e),Y(!0)}function ee(e,t){t.currentTarget.blur(),O({title:"\u4f60\u786e\u5b9a\u8981\u5220\u9664\u5f53\u524d\u9879\u5417?",icon:u.createElement(d.Z,null),onOk(){return(0,s.Z)((0,c.Z)().mark((function t(){return(0,c.Z)().wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,(0,S.Fv)({ids:[e.id]});case 3:l.default.success("\u5220\u9664\u6210\u529f"),K(H+1),t.next=10;break;case 7:t.prev=7,t.t0=t["catch"](0),l.default.error("\u5220\u9664\u5931\u8d25");case 10:case"end":return t.stop()}}),t,null,[[0,7]])})))()}})}return u.createElement("div",{className:h()["project-template"]},u.createElement(o.Z,{activeKey:a,onChange:m},A.map(((e,t)=>u.createElement(q,{tab:e,key:t.toString()},u.createElement("div",{className:h().list},b.map((e=>u.createElement("div",{key:e.id,className:h()["item-list"]},u.createElement("div",{className:h()["item-img"]},u.createElement("img",{style:{width:"50px",height:"50px"},src:e.cover,alt:e.name})),u.createElement("div",{className:h()["item-info"]},u.createElement("div",{className:h().name},e.name),u.createElement("div",{className:"".concat(h()["color-light"]," ").concat(h().intro)},e.intro)),u.createElement("div",{className:"".concat(h()["color-light"]," ").concat(h()["item-tasks"])},e.project_template_tasks.map(((t,a)=>u.createElement("span",{key:t.id},t.name,a!==e.project_template_tasks.length-1&&u.createElement(p.Z,{style:{margin:"0 8px"}}))))),0===t&&u.createElement(n.Z,{className:h()["item-control"]},u.createElement(r.Z,{icon:u.createElement(Z.Z,null),shape:"circle",size:"small",onClick:t=>X(e,t)}),u.createElement(r.Z,{icon:u.createElement(f.Z,null),shape:"circle",size:"small",onClick:t=>Q(e,t)}),u.createElement(r.Z,{icon:u.createElement(v.Z,null),shape:"circle",size:"small",onClick:t=>ee(e,t)})))))))))),u.createElement(r.Z,{className:h()["create-template"],type:"primary",icon:u.createElement(E.Z,null),onClick:()=>Q(null)},"\u521b\u5efa\u9879\u76ee\u6a21\u677f"),u.createElement(T,{editVisible:C,selectedTemplate:P,handleEditSuccess:R}),u.createElement(I,{taskVisible:W,selectedTemplate:P,handleTaskEditSuccess:J}))};H.menu={name:"\u9879\u76ee\u6a21\u677f",icon:"SmileOutlined"},H.order=3;var K=H}}]);