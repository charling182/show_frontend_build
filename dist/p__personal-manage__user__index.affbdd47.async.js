(self["webpackChunk"]=self["webpackChunk"]||[]).push([[87],{36814:function(e,t,n){"use strict";function r(e){if(null==e)throw new TypeError("Cannot destructure "+e)}n.d(t,{Z:function(){return r}})},54807:function(e){e.exports={"user-management":"user-management___1RCbB",header:"header___YeBRM",pagination:"pagination___1DxBR"}},17896:function(e,t,n){"use strict";n.r(t),n.d(t,{default:function(){return W}});n(91772);var r=n(12774),a=(n(36805),n(70236)),i=(n(68137),n(50532)),l=(n(13753),n(48429)),o=(n(14943),n(74356)),s=(n(14643),n(92909)),c=n(90636),u=n(11849),d=n(3182),m=n(2824),f=(n(26780),n(86444)),h=n(67294),p=n(87588),g=(n(90140),n(69984)),Z=(n(67604),n(76592)),v=n(30155),w=Z.Z.Item,E=e=>{var t=e.editRow,n=e.userManagementVisible,r=e.setUserManagementVisible,a=e.onUserManagementEditSuccess,l=void 0===a?()=>{}:a,o=Z.Z.useForm(),p=(0,m.Z)(o,1),E=p[0],k=(0,h.useState)(""),y=(0,m.Z)(k,2),b=(y[0],y[1],(0,h.useState)(!1)),x=(0,m.Z)(b,2),S=(x[0],x[1],{username:[{required:!0,message:"\u8bf7\u8f93\u5165\u7528\u6237\u540d"},{min:2,max:60,message:"\u957f\u5ea6\u5728 2 \u5230 60 \u4e2a\u5b57\u7b26"}],nickname:[{min:2,max:60,message:"\u957f\u5ea6\u5728 2 \u5230 60 \u4e2a\u5b57\u7b26"}],email:[{required:!0,message:"\u8bf7\u8f93\u5165\u90ae\u7bb1"},{type:"email",message:"\u8bf7\u8f93\u5165\u6709\u6548\u7684\u7535\u5b50\u90ae\u4ef6\u5730\u5740"}],phone:[{pattern:/^1\d{10}$/,message:"\u8bf7\u8f93\u5165\u6709\u6548\u7684\u624b\u673a\u53f7\u7801"}]}),C=()=>{E.resetFields(),r(!1)},M=function(){var e=(0,d.Z)((0,c.Z)().mark((function e(){var n,r,a;return(0,c.Z)().wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,E.validateFields();case 3:return n=e.sent,e.next=6,(0,v.rE)((0,u.Z)((0,u.Z)({},n),{},{id:t.id}));case 6:r=e.sent,a=r.code,200===a&&(s.default.success("\u4fee\u6539\u6210\u529f"),l()),e.next=14;break;case 11:e.prev=11,e.t0=e["catch"](0),console.log(e.t0);case 14:case"end":return e.stop()}}),e,null,[[0,11]])})));return function(){return e.apply(this,arguments)}}();return(0,h.useEffect)((()=>{t&&t.id&&E.setFieldsValue(t)}),[t]),h.createElement(f.Z,{title:"\u7f16\u8f91\u7528\u6237",open:n,onCancel:C,onOk:M,destroyOnClose:!0},h.createElement(Z.Z,{form:E,labelCol:{span:6},wrapperCol:{span:14}},h.createElement(w,{label:"\u7528\u6237\u540d",name:"username",rules:S.username},h.createElement(i.Z,{disabled:!0})),h.createElement(w,{label:"\u6635\u79f0",name:"nickname",rules:S.nickname},h.createElement(i.Z,null)),h.createElement(w,{label:"\u90ae\u7bb1",name:"email",rules:S.email},h.createElement(i.Z,{disabled:!0})),h.createElement(w,{label:"\u624b\u673a",name:"phone",rules:S.phone},h.createElement(i.Z,null)),h.createElement(w,{label:"\u516c\u53f8",name:"company"},h.createElement(i.Z,null)),h.createElement(w,{label:"\u57ce\u5e02",name:"city"},h.createElement(i.Z,null)),h.createElement(Z.Z.Item,{label:"\u72b6\u6001",name:"state"},h.createElement(g.ZP.Group,null,h.createElement(g.ZP,{value:1},"\u6b63\u5e38"),h.createElement(g.ZP,{value:0},"\u505c\u7528")))))},k=E,y=(n(44862),n(42091)),b=n(91966),x=n.n(b),S=e=>{var t=e.editRow,n=e.userRoleManagementVisible,r=e.setUserRoleManagementVisible,a=e.onUserRoleManagementEditSuccess,i=void 0===a?()=>{}:a,l=(0,h.useState)([]),o=(0,m.Z)(l,2),u=o[0],p=o[1],g=(0,h.useState)([]),Z=(0,m.Z)(g,2),w=Z[0],E=Z[1],k=(0,h.useState)([]),b=(0,m.Z)(k,2),S=b[0],C=b[1],M=(0,h.useState)(!1),R=(0,m.Z)(M,2),I=R[0],V=R[1],W=(0,h.useState)(!1),_=(0,m.Z)(W,2),O=_[0],H=_[1],N=(0,h.useState)([]),j=(0,m.Z)(N,2),U=j[0],z=j[1];(0,h.useEffect)((()=>{n&&t&&t.id&&Promise.all([B(),F()]).then((()=>{}))}),[n]);var B=function(){var e=(0,d.Z)((0,c.Z)().mark((function e(){var t,n;return(0,c.Z)().wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,(0,v.JV)({limit:1e3,offset:0});case 2:t=e.sent,n=t.data.rows,p(n);case 5:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),F=function(){var e=(0,d.Z)((0,c.Z)().mark((function e(){var n,r,a;return(0,c.Z)().wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,(0,v.Rg)({user_id:t.id,limit:1e3,offset:0});case 2:n=e.sent,r=n.data.rows,E(r),a=r.map((e=>e.role.id)),C(a),z(a);case 8:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),T=function(){var e=(0,d.Z)((0,c.Z)().mark((function e(){var n,r,a;return(0,c.Z)().wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(n=x()(U,S),!n.length){e.next=7;break}return e.next=4,(0,v.q2)({user_id:t.id,role_ids:n});case 4:r=e.sent,a=r.msg,s.default.success(a);case 7:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),D=function(){var e=(0,d.Z)((0,c.Z)().mark((function e(){var t,n,r,a;return(0,c.Z)().wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(t=x()(S,U),n=t.map((e=>w.find((t=>t.role.id===e)).id)),!n.length){e.next=8;break}return e.next=5,(0,v.k8)({ids:n});case 5:r=e.sent,a=r.msg,s.default.success(a);case 8:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),P=function(){var e=(0,d.Z)((0,c.Z)().mark((function e(){return(0,c.Z)().wrap((function(e){while(1)switch(e.prev=e.next){case 0:T(),D(),i();case 3:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),L=()=>{E([]),p([]),z([]),C([]),V(!1),H(!0),r(!1)},Y=e=>{H(!1),V(e.target.checked),z(e.target.checked?u.map((e=>e.id)):[])},q=e=>{V(e.length===u.length),H(e.length>0&&e.length<u.length),z(e)};return h.createElement(f.Z,{title:"\u89d2\u8272\u7ba1\u7406",open:n,onCancel:L,onOk:P,width:500},h.createElement(y.Z,{checked:I,indeterminate:O,onChange:Y},"\u5168\u9009"),h.createElement("div",{style:{margin:"15px 0"}}),h.createElement(y.Z.Group,{value:U,onChange:q},u.map(((e,t)=>h.createElement(y.Z,{key:t,value:e.id},e.name)))))},C=S,M=n(54807),R=n.n(M),I=f.Z.confirm,V=()=>{var e=(0,h.useState)([]),t=(0,m.Z)(e,2),n=t[0],f=t[1],g=(0,h.useState)(!0),Z=(0,m.Z)(g,2),w=Z[0],E=Z[1],y=(0,h.useState)(0),b=(0,m.Z)(y,2),x=b[0],S=b[1],M=(0,h.useState)([]),V=(0,m.Z)(M,2),W=V[0],_=V[1],O=(0,h.useState)({prop_order:"",order:"",pageNo:1,pageSize:10,keyword:""}),H=(0,m.Z)(O,2),N=H[0],j=H[1],U=(0,h.useState)(""),z=(0,m.Z)(U,2),B=z[0],F=z[1],T=(0,h.useState)(0),D=(0,m.Z)(T,2),P=D[0],L=D[1],Y=(0,h.useState)({}),q=(0,m.Z)(Y,2),X=q[0],G=q[1],K=(0,h.useState)(!1),J=(0,m.Z)(K,2),$=J[0],A=J[1],Q=(0,h.useState)(!1),ee=(0,m.Z)(Q,2),te=ee[0],ne=ee[1];(0,h.useEffect)((()=>{re()}),[N,P]);var re=function(){var e=(0,d.Z)((0,c.Z)().mark((function e(){var t,n,r,a,i,l;return(0,c.Z)().wrap((function(e){while(1)switch(e.prev=e.next){case 0:return E(!0),t=N.pageSize,n=N.pageNo,e.next=4,(0,v.lE)((0,u.Z)((0,u.Z)({},N),{},{limit:t,offset:(n-1)*t}));case 4:r=e.sent,a=r.data,i=a.rows,l=a.count,f(i),S(l),E(!1);case 11:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),ae=e=>{G(e),ne(!0)},ie=e=>{e&&e.id&&(G(e),A(!0))},le=()=>{G({}),L(P+1),A(!1)},oe=()=>{G({}),L(P+1),ne(!1)},se=e=>{if(e.id)I({title:"\u4f60\u786e\u5b9a\u8981\u5220\u9664\u5f53\u524d\u9879\u5417?",icon:h.createElement(p.Z,null),onOk:function(){var t=(0,d.Z)((0,c.Z)().mark((function t(){return(0,c.Z)().wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,(0,v.h8)({ids:[e.id]});case 2:s.default.success("\u5220\u9664\u6210\u529f"),L(P+1);case 4:case"end":return t.stop()}}),t)})));function n(){return t.apply(this,arguments)}return n}()});else{if(!(W.length>0))return s.default.error("\u672a\u9009\u4e2d\u4efb\u4f55\u884c"),!1;var t=W.map((e=>e.id));I({title:"\u4f60\u786e\u5b9a\u8981\u5220\u9664\u9009\u4e2d\u9879\u5417?",icon:h.createElement(p.Z,null),onOk:function(){var e=(0,d.Z)((0,c.Z)().mark((function e(){return(0,c.Z)().wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,(0,v.h8)({ids:t});case 2:s.default.success("\u5220\u9664\u6210\u529f"),L(P+1);case 4:case"end":return e.stop()}}),e)})));function n(){return e.apply(this,arguments)}return n}()})}},ce=e=>{j((0,u.Z)((0,u.Z)({},N),{},{pageSize:e})),re()},ue=e=>{j((0,u.Z)((0,u.Z)({},N),{},{pageNo:e})),re()},de=e=>{F(e),j((0,u.Z)((0,u.Z)({},N),{},{keyword:e,pageNo:1}))},me=[{title:"ID",dataIndex:"id",key:"id",sorter:!0,fixed:"left",width:80},{title:"\u7528\u6237\u540d",dataIndex:"username",key:"username",ellipsis:!0,width:100},{title:"\u6635\u79f0",dataIndex:"nickname",key:"nickname",ellipsis:!0,width:100},{title:"\u89d2\u8272",dataIndex:"roles",key:"roles",width:200,render:e=>h.createElement(h.Fragment,null,e.map((e=>h.createElement(o.Z,{color:"processing",key:e.id},e.name))))},{title:"\u5934\u50cf",dataIndex:"avatar",key:"avatar",width:100,render:e=>h.createElement("img",{src:e||"",width:40,height:40,style:{borderRadius:6}})},{title:"\u90ae\u7bb1",dataIndex:"email",key:"email",width:200},{title:"\u624b\u673a",dataIndex:"phone",key:"phone",width:200},{title:"\u72b6\u6001",dataIndex:"state",key:"state",width:100,render:e=>h.createElement("span",{style:{color:1===e?"#67c23a":"#F56C6C"}},1===e?"\u6b63\u5e38":"\u505c\u7528")},{title:"\u6700\u8fd1\u767b\u5f55\u65f6\u95f4",dataIndex:"last_login",key:"last_login",width:200},{title:"\u64cd\u4f5c",dataIndex:"operation",key:"operation",fixed:"right",width:300,render:(e,t)=>h.createElement(h.Fragment,null,h.createElement(l.Z,{type:"link",onClick:()=>ae(t)},"\u89d2\u8272\u7ba1\u7406"),h.createElement(l.Z,{type:"link",onClick:()=>ie(t)},"\u7f16\u8f91"),h.createElement(l.Z,{type:"link",onClick:()=>se(t)},"\u5220\u9664"))}];return h.createElement("div",{className:R()["user-management"]},h.createElement("div",{className:R().header},h.createElement(l.Z,{danger:!0,onClick:()=>se({})},"\u6279\u91cf\u5220\u9664"),h.createElement(i.Z.Search,{style:{width:"240px"},placeholder:"\u7528\u6237\u540d/\u90ae\u7bb1/\u624b\u673a",allowClear:!0,value:B,onSearch:de,onChange:e=>{F(e.target.value.trim()),!e.target.value.trim()&&j((0,u.Z)((0,u.Z)({},N),{},{keyword:e.target.value.trim(),pageNo:1}))}})),h.createElement(a.Z,{rowSelection:{onChange:(e,t)=>{_(t)}},scroll:{x:1300},columns:me,dataSource:n,loading:w,pagination:!1,rowKey:"id",onChange:(e,t,n)=>{var r=n.order?n.order.replace("end",""):"";j((0,u.Z)((0,u.Z)({},N),{},{prop_order:n.columnKey,order:r}))}}),h.createElement(r.Z,{className:R().pagination,showSizeChanger:!0,current:N.pageNo,pageSize:N.pageSize,total:x,onChange:ue,onShowSizeChange:ce,style:{marginTop:"16px"}}),h.createElement(k,{editRow:X,userManagementVisible:$,setUserManagementVisible:A,onUserManagementEditSuccess:le}),h.createElement(C,{editRow:X,userRoleManagementVisible:te,setUserRoleManagementVisible:ne,onUserRoleManagementEditSuccess:oe}))};V.menu={name:"\u7528\u6237\u7ba1\u7406",icon:"LineChartOutlined"},V.order=1;var W=V},85713:function(e,t,n){"use strict";function r(e){return"object"==typeof e&&null!=e&&1===e.nodeType}function a(e,t){return(!t||"hidden"!==e)&&"visible"!==e&&"clip"!==e}function i(e,t){if(e.clientHeight<e.scrollHeight||e.clientWidth<e.scrollWidth){var n=getComputedStyle(e,null);return a(n.overflowY,t)||a(n.overflowX,t)||function(e){var t=function(e){if(!e.ownerDocument||!e.ownerDocument.defaultView)return null;try{return e.ownerDocument.defaultView.frameElement}catch(e){return null}}(e);return!!t&&(t.clientHeight<e.scrollHeight||t.clientWidth<e.scrollWidth)}(e)}return!1}function l(e,t,n,r,a,i,l,o){return i<e&&l>t||i>e&&l<t?0:i<=e&&o<=n||l>=t&&o>=n?i-e-r:l>t&&o<n||i<e&&o>n?l-t+a:0}n.d(t,{Z:function(){return m}});var o=function(e,t){var n=window,a=t.scrollMode,o=t.block,s=t.inline,c=t.boundary,u=t.skipOverflowHiddenElements,d="function"==typeof c?c:function(e){return e!==c};if(!r(e))throw new TypeError("Invalid target");for(var m,f,h=document.scrollingElement||document.documentElement,p=[],g=e;r(g)&&d(g);){if((g=null==(f=(m=g).parentElement)?m.getRootNode().host||null:f)===h){p.push(g);break}null!=g&&g===document.body&&i(g)&&!i(document.documentElement)||null!=g&&i(g,u)&&p.push(g)}for(var Z=n.visualViewport?n.visualViewport.width:innerWidth,v=n.visualViewport?n.visualViewport.height:innerHeight,w=window.scrollX||pageXOffset,E=window.scrollY||pageYOffset,k=e.getBoundingClientRect(),y=k.height,b=k.width,x=k.top,S=k.right,C=k.bottom,M=k.left,R="start"===o||"nearest"===o?x:"end"===o?C:x+y/2,I="center"===s?M+b/2:"end"===s?S:M,V=[],W=0;W<p.length;W++){var _=p[W],O=_.getBoundingClientRect(),H=O.height,N=O.width,j=O.top,U=O.right,z=O.bottom,B=O.left;if("if-needed"===a&&x>=0&&M>=0&&C<=v&&S<=Z&&x>=j&&C<=z&&M>=B&&S<=U)return V;var F=getComputedStyle(_),T=parseInt(F.borderLeftWidth,10),D=parseInt(F.borderTopWidth,10),P=parseInt(F.borderRightWidth,10),L=parseInt(F.borderBottomWidth,10),Y=0,q=0,X="offsetWidth"in _?_.offsetWidth-_.clientWidth-T-P:0,G="offsetHeight"in _?_.offsetHeight-_.clientHeight-D-L:0,K="offsetWidth"in _?0===_.offsetWidth?0:N/_.offsetWidth:0,J="offsetHeight"in _?0===_.offsetHeight?0:H/_.offsetHeight:0;if(h===_)Y="start"===o?R:"end"===o?R-v:"nearest"===o?l(E,E+v,v,D,L,E+R,E+R+y,y):R-v/2,q="start"===s?I:"center"===s?I-Z/2:"end"===s?I-Z:l(w,w+Z,Z,T,P,w+I,w+I+b,b),Y=Math.max(0,Y+E),q=Math.max(0,q+w);else{Y="start"===o?R-j-D:"end"===o?R-z+L+G:"nearest"===o?l(j,z,H,D,L+G,R,R+y,y):R-(j+H/2)+G/2,q="start"===s?I-B-T:"center"===s?I-(B+N/2)+X/2:"end"===s?I-U+P+X:l(B,U,N,T,P+X,I,I+b,b);var $=_.scrollLeft,A=_.scrollTop;R+=A-(Y=Math.max(0,Math.min(A+Y/J,_.scrollHeight-H/J+G))),I+=$-(q=Math.max(0,Math.min($+q/K,_.scrollWidth-N/K+X)))}V.push({el:_,top:Y,left:q})}return V};function s(e){return e===Object(e)&&0!==Object.keys(e).length}function c(e,t){void 0===t&&(t="auto");var n="scrollBehavior"in document.body.style;e.forEach((function(e){var r=e.el,a=e.top,i=e.left;r.scroll&&n?r.scroll({top:a,left:i,behavior:t}):(r.scrollTop=a,r.scrollLeft=i)}))}function u(e){return!1===e?{block:"end",inline:"nearest"}:s(e)?e:{block:"start",inline:"nearest"}}function d(e,t){var n=e.isConnected||e.ownerDocument.documentElement.contains(e);if(s(t)&&"function"===typeof t.behavior)return t.behavior(n?o(e,t):[]);if(n){var r=u(t);return c(o(e,r),r.behavior)}}var m=d},23270:function(e){e.exports=function(e,t,n,r){var a=n?n.call(r,e,t):void 0;if(void 0!==a)return!!a;if(e===t)return!0;if("object"!==typeof e||!e||"object"!==typeof t||!t)return!1;var i=Object.keys(e),l=Object.keys(t);if(i.length!==l.length)return!1;for(var o=Object.prototype.hasOwnProperty.bind(t),s=0;s<i.length;s++){var c=i[s];if(!o(c))return!1;var u=e[c],d=t[c];if(a=n?n.call(r,u,d,c):void 0,!1===a||void 0===a&&u!==d)return!1}return!0}}}]);